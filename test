#!/usr/bin/env bash
#
# Run all etcd tests
# ./test
# ./test -v
#
# Run tests for one package
#
# PKG=./wal ./test
# PKG=snap ./test
set -e

# Invoke ./cover for HTML output
COVER=${COVER:-"-cover"}

GO_BUILD_FLAGS="-a -v"
source ./build

# Set up gopath so tests use vendored dependencies
export GOPATH=${PWD}/gopath
rm -rf $GOPATH/src
mkdir -p $GOPATH
ln -s ${PWD}/cmd/vendor $GOPATH/src

cd clientv3/integration
go test -v -count=20 -run TestTxnWriteFail
go test -v -race -cpu=2,4 -count=25 -run TestTxnWriteFail
cd -
